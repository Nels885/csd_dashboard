{% load i18n widget_tweaks corvet_tags %}

<div class="{% if form.non_field_errors %}invalid{% endif %} text-center bg-danger text-white text-uppercase font-weight-bold mb-2">
    {% for error in form.non_field_errors %}
        {{ error }}
    {% endfor %}
</div>
<div class="row">
    <section class="col-sm-3">
        <h6 class="font-weight-bold text-uppercase">VIN/CORVET :</h6>
        <button class="log-btn btn btn-secondary btn-block" data-id="{% url 'squalaetp:log_detail' xelon.pk %}">Info VIN Raspeedi</button>
        <button class="bs-large-modal btn btn-secondary btn-block mb-3" data-form-url="{% url 'squalaetp:vin_edit' xelon.pk %}" {% if not perms.squalaetp.change_vin %}disabled{% endif %}>
            Modification
        </button>
        <button class="bs-large-modal btn btn-secondary btn-block mb-3" data-form-url="{% url 'squalaetp:vin_email' xelon.pk %}" {% if not perms.squalaetp.email_vin %}disabled{% endif %}>
            <i class="fas fa-envelope pr-2"></i>Atelier<i class="fas fa-long-arrow-alt-right px-2"></i>Admin
        </button>
{#        <div class="dropdown no-arrow show">#}
{#            <button class="btn btn-secondary btn-block mb-3 dropdown-toggle" id="emailVin" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" {% if not perms.squalaetp.email_vin %}disabled{% endif %}>#}
{#                <i class="fas fa-envelope pr-2"></i>Atelier<i class="fas fa-long-arrow-alt-right px-2"></i>Admin#}
{#            </button>#}
{#            <div class="dropdown-menu btn-block" aria-labelledby="emailVin">#}
{#                <a class="dropdown-item bs-large-modal" data-form-url="{% url 'squalaetp:vin_email' xelon.pk %}" href="#">Modification Xelon</a>#}
{#                <a class="dropdown-item" href="#">Vérification client</a>#}
{#            </div>#}
{#        </div>#}
        <button class="bs-large-modal btn btn-secondary btn-block mb-3" data-form-url="{% url 'squalaetp:adm_email' xelon.pk %}" {% if not perms.squalaetp.email_admin %}disabled{% endif %}>
            <i class="fas fa-envelope pr-2"></i>Admin<i class="fas fa-long-arrow-alt-right px-2"></i>Atelier
        </button>
        <hr>

        <h6 class="font-weight-bold text-uppercase">Modèle PRODUIT :</h6>
        <button class="bs-large-modal btn btn-secondary btn-block mb-3" data-form-url="{% url 'squalaetp:prod_edit' xelon.pk %}" {% if not perms.squalaetp.change_product %}disabled{% endif %}>
            Modification
        </button>
        <button class="bs-large-modal btn btn-secondary btn-block mb-3" data-form-url="{% url 'squalaetp:prod_email' xelon.pk %}" {% if not perms.squalaetp.email_product %}disabled{% endif %}>
            <i class="fas fa-envelope pr-2"></i>Atelier<i class="fas fa-long-arrow-alt-right px-2"></i>Admin
        </button>
        <button class="bs-large-modal btn btn-secondary btn-block mb-3" data-form-url="{% url 'squalaetp:adm_email' xelon.pk %}?select=prod" {% if not perms.squalaetp.email_admin %}disabled{% endif %}>
            <i class="fas fa-envelope pr-2"></i>Admin<i class="fas fa-long-arrow-alt-right px-2"></i>Atelier
        </button>
        <hr class="mb-5">

        <h6 class="font-weight-bold text-uppercase">Outils réparation :</h6>
        {% if xelon.is_active %}
            <a class="btn btn-secondary btn-block mb-3" href="#">PROG Actif</a>
        {% else %}
            <a class="btn btn-primary btn-block mb-3" href="{% url 'squalaetp:prog_activate' xelon.pk %}">Activer PROG</a>
        {% endif %}
        <a class="btn btn-secondary btn-block mb-3" href="{% url 'squalaetp:barcode_pdf' pk=xelon.pk %}" target="_blank">Générer code barre</a>
        <a class="btn btn-success btn-block" href="{% url 'squalaetp:generate' %}">Générer Squalaetp</a>
    </section>

    <section class="col-sm-9">

        {% include 'squalaetp/format/input_ihm.html' with label="V.I.N. (XELON)" value=xelon.vin %}

        {% include 'squalaetp/format/input_ihm.html' with label="Modèle produit (XELON)" value=xelon.modele_produit %}

        {% include 'squalaetp/format/input_ihm.html' with label="Modèle véhicule (XELON)" value=xelon.modele_vehicule %}

        {% if corvet.donnee_marque_commerciale == "0P" %}
            {% include 'squalaetp/format/input_ihm.html' with label="Modèle véhicule (CORVET)" value=corvet.donnee_ligne_de_produit|get_corvet:"DON_LIN_PROD 0" %}
        {% else %}
            {% include 'squalaetp/format/input_ihm.html' with label="Modèle véhicule (CORVET)" value=corvet.donnee_ligne_de_produit|get_corvet:"DON_LIN_PROD 1" %}
        {% endif %}

        {% if collapse.cmm %}

            <!-- ECU Info -->
            <hr>

            {% include 'squalaetp/format/input_ihm.html' with label="CMM MODEL - Calculateur Moteur Multifonction" value=corvet.prods.cmm.name|default:"???" %}

            {% include 'squalaetp/format/input_ihm.html' with label="electronique_14a"|get_field_name value=corvet.electronique_14a %}

            {% include 'squalaetp/format/input_ihm.html' with label="electronique_94a"|get_field_name value=corvet.electronique_94a %}

            {% include 'squalaetp/format/input_ihm.html' with label="electronique_34a"|get_field_name value=corvet.electronique_34a %}

            {% include 'squalaetp/format/input_ihm.html' with label="electronique_44a"|get_field_name value=corvet.electronique_44a %}

        {% elif collapse.bsi %}

            <!-- BSI Info -->
            <hr>

            {% include 'squalaetp/format/input_ihm.html' with label="BSI MODEL - Boitier Servitude Intelligent" value=corvet.prods.bsi.name|default:"???" %}

            {% include 'squalaetp/format/input_ihm.html' with label="electronique_14b"|get_field_name value=corvet.electronique_14b %}

            {% include 'squalaetp/format/input_ihm.html' with label="electronique_94b"|get_field_name value=corvet.electronique_94b %}

            {% include 'squalaetp/format/input_ihm.html' with label="electronique_44b"|get_field_name value=corvet.electronique_44b %}

        {% elif collapse.hdc %}

            <!-- BSI Info -->
            <hr>

            {% include 'squalaetp/format/input_ihm.html' with label="HDC MODEL - Haut de Colonne de Direction" value=corvet.prods.hdc.name|default:"???" %}

            {% include 'squalaetp/format/input_ihm.html' with label="electronique_16p"|get_field_name value=corvet.electronique_16p %}

            {% include 'squalaetp/format/input_ihm.html' with label="electronique_46p"|get_field_name value=corvet.electronique_46p %}

        {% endif %}

        <hr>

        {% if corvet.electronique_14x %}

            <!-- BTEL Info -->

            {% include 'squalaetp/format/input_ihm.html' with label="BTEL MODEL - Boitier Télématique" value=btel_model %}

            {% include 'squalaetp/format/input_ihm.html' with label="electronique_14x"|get_field_name value=corvet.electronique_14x %}

            {% include 'squalaetp/format/input_ihm.html' with label="electronique_94x"|get_field_name value=corvet.electronique_94x %}

            {% include 'squalaetp/format/input_ihm.html' with label="electronique_44x"|get_field_name value=corvet.electronique_44x %}

        {% elif corvet.electronique_14 %}

            <!-- RADIO Info -->

            {% include 'squalaetp/format/input_ihm.html' with label="RADIO MODEL - Recepteur Radio" value=corvet.prods.radio.get_name_display %}

            {% include 'squalaetp/format/input_ihm.html' with label="electronique_14f"|get_field_name value=corvet.electronique_14f %}

            {% include 'squalaetp/format/input_ihm.html' with label="electronique_94f"|get_field_name value=corvet.electronique_94f %}

            {% include 'squalaetp/format/input_ihm.html' with label="electronique_44f"|get_field_name value=corvet.electronique_44f %}

        {% endif %}

    </section>
</div>

{% if xelon.actions.all %}

    <div class="row">
        <section class="col-sm-12 mt-4">
            <table class="table table-bordered table-condensed text-nowrap">
                <caption style="caption-side: top;">
                    <h3 class="text-gray-800">HISTORIQUE MODIFICATIONS :</h3>
                </caption>
                <thead>
                <tr>
                    <th>Action</th>
                    <th>Modifié le</th>
                    <th>Modifié par</th>
                </tr>
                </thead>
                <tbody>

                {% for action in xelon.actions.all %}

                    <tr>
                        <td>{{ action.content|linebreaksbr }}</td>
                        <td>{{ action.modified_at }}</td>
                        <td>{{ action.modified_by }}</td>
                    </tr>

                {% endfor %}

                </tbody>
            </table>
        </section>
    </div>

{% endif %}
