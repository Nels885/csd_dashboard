{% load i18n widget_tweaks %}

<form id="infotechForm" method="post" action="">

    {% csrf_token %}

    <div class="modal-header">
        <h3 class="modal-title">Ajout Info Tech</h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <div class="modal-body">

        <div class="{% if form.non_field_errors %}invalid{% endif %} text-center bg-danger text-white text-uppercase font-weight-bold mb-2">
            {% for error in form.non_field_errors %}
                {{ error }}
            {% endfor %}
        </div>

        <div class="form-group row">
            <label for="{{ form.username.id_for_label }}" class="col-form-label col-sm-2">QUI *</label>
            <div class="col-sm-4">
                {% render_field form.username class="form-control" %}
                <div class="{% if form.username.errors %} invalid{% endif %}">
                    {% for error in form.username.errors %}
                        <p class="help-block font-weight-bold text-danger">{{ error }}</p>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="form-group row">
            <label for="{{ form.item.id_for_label }}" class="col-form-label col-sm-2">Objet *</label>
            <div class="col-sm-10 mb-3 mb-sm-0">
                {% render_field form.item class="form-control" %}
                <div class="{% if form.item.errors %} invalid{% endif %}">
                    {% for error in form.item.errors %}
                        <p class="help-block font-weight-bold text-danger">{{ error }}</p>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="form-group row">
            <label for="{{ form.mailing.id_for_label }}" class="col-form-label col-sm-2">Liste emails *</label>
            <div class="col-sm-6 mb-3 mb-sm-0">
                {% render_field form.mailing class="form-control" %}
                <div class="{% if form.mailing.errors %} invalid{% endif %}">
                    {% for error in form.mailing.errors %}
                        <p class="help-block font-weight-bold text-danger">{{ error }}</p>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="form-group row">
            <label for="{{ form.to.id_for_label }}" class="col-form-label col-sm-2">Ã€ *</label>
            <div class="col-sm-10 mb-3 mb-sm-0">
                {% render_field form.to class="form-control" %}
                <div class="{% if form.to.errors %} invalid{% endif %}">
                    {% for error in form.to.errors %}
                        <p class="help-block font-weight-bold text-danger">{{ error }}</p>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="form-group row">
            <label for="{{ form.cc.id_for_label }}" class="col-form-label col-sm-2">Cc</label>
            <div class="col-sm-10 mb-3 mb-sm-0">
                {% render_field form.cc class="form-control" %}
                <div class="{% if form.cc.errors %} invalid{% endif %}">
                    {% for error in form.cc.errors %}
                        <p class="help-block font-weight-bold text-danger">{{ error }}</p>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="form-group row">
            <label for="{{ form.info.id_for_label }}" class="col-form-label col-sm-2">Infos *</label>
            <div class="col-sm-10">
                {% render_field form.info class="form-control" rows=5 %}
                <div class="{% if form.info.errors %} invalid{% endif %}">
                    {% for error in form.info.errors %}
                        <p class="help-block font-weight-bold text-danger">{{ error }}</p>
                    {% endfor %}
                </div>
            </div>
        </div>

    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">{% trans "Cancel" %}</button>
        <button type="submit" class="btn btn-primary">{% trans 'Create' %}</button>
    </div>
</form>

<script type="text/javascript">
    $('#id_mailing').change(function () {
        $.ajax({
            method: "GET",
            url: "{% url 'tools:infotech_mailing_ajax' %}" + "?pk=" + $(this).val(),
            success: function (data) {
                console.log(data);
                $('#id_to').val(data.to_list);
                $('#id_cc').val(data.cc_list);
            },
            error: function (error_data) {
                console.log("error");
                console.log(error_data);
            }
        });
    });

</script>