{% extends 'format/detail_format.html' %}

{% load static i18n %}

{% block detail_content %}

    <button id="connect" class="btn btn-primary mb-2">Connect</button>
    <div id="terminal" style="position:relative; width:100%; height:100%"></div>
    {#<button id="arduinoButton">Talk to Arduino</button>#}
    {##}
    {#<div id="target"></div>#}

{% endblock %}

{% block extrascripts %}

<script src="{% static 'tools/js/usb_device/hterm_all.js' %}"></script>
<script src="{% static 'tools/js/usb_device/serial.js' %}"></script>
<script src="{% static 'tools/js/usb_device/console.js' %}"></script>

{#<script>#}
{#    document.getElementById('connect').addEventListener('click', function () {#}
{#        if (navigator.usb) {#}
{#            talkToArduino();#}
{#        } else {#}
{#            alert('WebUSB not supported.');#}
{#        }#}
{#    });#}
{##}
{#    async function talkToArduino() {#}
{#        try {#}
{#            device = await navigator.usb.requestDevice({ 'filters': [] });#}
{#            console.log(device);#}
{##}
{#            await device.open();#}
{#            if (device.configuration === null) {#}
{#                await device.selectConfiguration(0);#}
{#            }#}
{#            await device.claimInterface(0);#}
{#            await device.selectAlternateInterface(0, 0);#}
{#            await device.controlTransferOut({#}
{#                requestType: "vendor",#}
{#                recipient: "device",#}
{#                request: 3 /* FTDI_SIO_SET_BAUDRATE_REQUEST */,#}
{#                value: 16696, // divisor_value#}
{#                index: 48000000 // divisor_index#}
{#            });#}
{#            let result = await device.transferIn(1, 64);#}
{#            console.log((new TextDecoder).decode(result.data));#}
{#        } catch (error) {#}
{#            console.log(error);#}
{#        }#}
{##}
{#    }#}
{#</script>#}

{#<script>#}
{#    document.addEventListener('DOMContentLoaded', event => {#}
{#        let button = document.getElementById('connect')#}
{##}
{#        button.addEventListener('click', async () => {#}
{#            let device#}
{##}
{#            try {#}
{#                device = await navigator.usb.requestDevice({ 'filters': [] });#}
{#                console.log(device);#}
{##}
{#                await device.open();#}
{#                if (device.configuration === null) {#}
{#                    await device.selectConfiguration(1);#}
{#                }#}
{#                await device.claimInterface(0);#}
{#                await device.selectAlternateInterface(0, 0);#}
{#                await device.controlTransferOut({#}
{#                    requestType: "vendor",#}
{#                    recipient: "device",#}
{#                    request: 3 /* FTDI_SIO_SET_BAUDRATE_REQUEST */,#}
{#                    value: 16696, // divisor_value#}
{#                    index: 48000000 // divisor_index#}
{#                });#}
{#                let result = await device.transferIn(1, 64);#}
{#                console.log((new TextDecoder).decode(result.data));#}
{#            } catch (error) {#}
{#                console.log(error)#}
{#            }#}
{##}
{#            await device.close()#}
{#        })#}
{#    })#}
{#</script>#}

{% endblock %}