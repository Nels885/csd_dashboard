{% extends 'format/detail_format.html' %}

{% load static i18n %}

{% block detail_content %}

    <table class="table table-striped" style="width: 100%;">
        <thead class="thead-dark text-uppercase">
            <tr>
                <th class="col-2">Nom</th>
                <th class="col-3">Commentaire</th>
                <th class="col-3">Status</th>
                <th class="col-2">Version</th>
                <th class="col-2"></th>
            </tr>
        </thead>
        <tbody>
            {% for obj in object_list %}
            <tr>
                <td class="font-weight-bold">{{ obj.name }}</td>
                <td class="">{{ obj.comment }}</td>
                <td class="font-weight-bold" id="{{ obj.name|slugify }}">Hors ligne</td>
                <td class="font-weight-bold" id="{{ obj.name|slugify }}-v"></td>
                <td id="{{ obj.name|slugify }}-btn">
                    <button class="btn btn-block btn-secondary" disabled>Configuration</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

{% endblock %}

{% block extrascripts %}

    <script type="text/javascript">
        const slugify = str =>
          str
            .toLowerCase()
            .trim()
            .replace(/[^\w\s-]/g, '')
            .replace(/[\s_-]+/g, '-')
            .replace(/^-+|-+$/g, '');

        function get_tool_info() {
            $.ajax({
                method: "get",
                url: "{% url 'prog:ajax_tool_info' %}",
                success: function(data) {
                    console.log(data);
                    for (let key in data) {
                        let href = data[key]['href'];
                        let idStatus = '#' + slugify(key);
                        let idVersion = idStatus + '-v';
                        let idButton = idStatus + '-btn';
                        $(idStatus).html(data[key]['status']);
                        $(idVersion).html(data[key]['version']);
                        if (data[key]['status_code'] === 404) {
                            $(idButton).html('<button class="btn btn-block btn-secondary" disabled>Configuration</button>');
                        } else {
                            $(idButton).html('<a class="btn btn-block btn-secondary" href="' + href + '" target="_blank">Configuration</a>');
                        }
                    }
                },
                error: function(error) {
                    console.log(error);
                }
            })
        }

        get_tool_info();
        setInterval(get_tool_info, 5000);
    </script>

{% endblock %}